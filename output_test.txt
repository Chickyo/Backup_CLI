ubuntu@LAPTOP-B4P5PES9:~/Backup_CLI_Linux$ tests/run_all_tests.sh
========================================
RUNNING ALL TESTS FOR BACKUP CLI PROJECT
========================================
=== TEST TAMPERING (Sửa đổi dữ liệu trái phép) ===
[1] Init và Backup dữ liệu gốc...
 -> Snapshot ID: 1767943057_4799
[2] Verify lần đầu (Mong đợi: OK)...
Verifying snapshot 1767943057_4799...
Checking rollback protection (roots.log)...
Verifying roots.log hash chain...
VERIFY OK.
[3] Tấn công: Sửa đổi 1 byte trong chunk...
 -> Corrupting chunk: store/chunks/21d506a93a64490e04ccd1e61be12cac8f087cbbffcf4d89e5b5bf6e4d2820bd
[4] Verify sau khi sửa chunk (Mong đợi: FAIL)...
Verifying snapshot 1767943057_4799...
VERIFY FAIL: Chunk 21d506a93a64490e04ccd1e61be12cac8f087cbbffcf4d89e5b5bf6e4d2820bd is corrupted (hash mismatch)
=== KẾT THÚC TEST TAMPER ===
----------------------------------------
=== TEST MANIFEST TAMPERING ===
[1] Creating backup...
 -> Snapshot ID: 1767943058_2810
[2] Verifying original snapshot...
Verifying snapshot 1767943058_2810...
Checking rollback protection (roots.log)...
Verifying roots.log hash chain...
VERIFY OK.
[3] Tampering with manifest.json...
[4] Verifying tampered snapshot...
Verifying snapshot 1767943058_2810...
VERIFY FAIL: Exception Extra data: line 1 column 82 (char 81)
=== MANIFEST TAMPER TEST COMPLETED ===
----------------------------------------
=== TEST ROLLBACK PROTECTION ===
 -> Created Snap 1: 1767943058_9443
 -> Created Snap 2: 1767943058_9443
[Attack] Sửa đổi metadata của Snapshot 2 (phá vỡ chain)...
Running Verify...
Verifying snapshot 1767943058_9443...
Checking rollback protection (roots.log)...
Verifying roots.log hash chain...
VERIFY FAIL: First snapshot cannot have non-zero prev_root!
----------------------------------------
=== TEST AUDIT LOG INTEGRITY ===
Generating logs...
[1] Checking valid audit log...
Verifying audit log...
AUDIT OK. Head Hash: c59b430a2ddd74c4b03bb3a9607e6557b15d65a722c0e6ca0184c6243fc89116
[2] Attacking audit log...
[3] Verifying tampered log...
Verifying audit log...
AUDIT CORRUPTED at line 2: Content modified.
PASS: Phát hiện sửa đổi Audit Log thành công!
----------------------------------------
=== TEST CRASH RECOVERY (JOURNAL) ===
-> Đã tạo giả lập crash: Snapshot 9999999999 chưa commit.
Running list-snapshots to trigger recovery...
PASS: Crash Recovery hoạt động tốt (Snapshot lỗi đã bị xoá).
----------------------------------------
========================================
=== TEST POLICY ===
========================================

[PASS] Admin permission test
.[PASS] Auditor denial test
.
----------------------------------------------------------------------
Ran 2 tests in 0.153s

OK
----------------------------------------
=== GENERATING 2000 FILES ===
Generating files...
  -> Created 200 files...
  -> Created 400 files...
  -> Created 600 files...
  -> Created 800 files...
  -> Created 1000 files...
  -> Created 1200 files...
  -> Created 1400 files...
  -> Created 1600 files...
  -> Created 1800 files...
  -> Created 2000 files...
=== GENERATION COMPLETE ===
Total files: 2000
Total size: 8.0M
----------------------------------------
========================================
=== TEST RESTORE & COMPARE PROJECT ===
========================================
[1] Creating backup of dataset_test...
Snapshot 1767943060_1144 created successfully. Root: 163e179ad605...
 -> Snapshot ID: 1767943060_1144
[2] Creating backup copy for comparison...
 -> Original file count: 2000
[3] Computing checksums of original files...
[4] Deleting 30% of files from dataset_test...
 -> Deleting first 5 directories...
    Removing: dataset_test/folder_2
    Removing: dataset_test/folder_6
    Removing: dataset_test/folder_4
    Removing: dataset_test/folder_10
    Removing: dataset_test/folder_9
 -> Files after deletion: 780 (deleted: 1220)
[5] Restoring from snapshot 1767943060_1144...
Verifying snapshot 1767943060_1144...
Checking rollback protection (roots.log)...
Verifying roots.log hash chain...
VERIFY OK.
Restoring snapshot 1767943060_1144 to dataset_test_restored...
Restore completed.
 -> Restored file count: 2000
PASS: File count matches (2000)
[6] Comparing directory structure...
PASS: Directory structure identical
[7] Comparing file contents (checksum)...
PASS: All file contents match (checksums identical)
[8] Deep comparison with diff -r...
PASS: Deep comparison successful - all files identical

=== CLEANUP SECTION ===
Bạn có muốn xóa các thư mục tạm và file checksum không? (y/n): n
Đã giữ lại các thư mục để bạn kiểm tra thủ công.
----------------------------------------
DONE.